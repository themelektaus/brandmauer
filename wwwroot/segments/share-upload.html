<i class="fas fa-paperclip" style="font-size: 2em; "></i>
<h2>Share</h2>
<div id="form" style="width: 20em; display: flex; flex-direction: column; flex: 0; gap: 1rem; ">
    <input name="file" id="file" type="file" multiple style="display: none; ">
    <label for="file">Drop file here or click to open dialog</label>
    <button style="align-self: center; " id="submit"><i class="fas fa-upload"></i>Upload</button>
</div>
<style>
    label[for="file"] {
        background: #0006;
        border: 2px dashed #fff5;
        padding: 1rem 1rem;
        cursor: pointer;
        box-sizing: border-box;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: .75rem;
        text-align: center;
    }
    label[for="file"]:hover {
        filter: brightness(1.4);
    }
    label[for="file"],
    label[for="file"] > div {
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>
<script>
    addEventListener(`load`, () =>
    {
        const $label = q(`label[for="file"]`)
        
        const updateLabel = () =>
        {
            let html = ``
            for (const file of $file.files)
                html += `<div>${file.name}</div>`
            $label.innerHTML = html
        }
        
        const $file = q(`#file`)
        $file.addEventListener('change', () => updateLabel())
        
        const register = (a, b) =>
        {
            for (const _a of a)
                document.body.addEventListener(_a, b)
        }
        
        register(['dragover', 'dragenter'], e =>
        {
            e.preventDefault()
        })
        
        register(['drop'], e =>
        {
            e.preventDefault()
            $file.files = e.dataTransfer.files
            updateLabel()
        })
        
        const $submit = q(`#submit`)
        
        $submit.addEventListener(`click`, async () =>
        {
            $submit.disabled = true
            
            const formData = new FormData()
            for (const file of $file.files)
                formData.append('files[]', file)
            
            const response = await fetch(`share`,
            {
                method: "POST",
                body: formData
            })
            
            if (response.ok)
            {
                const token = await response.text()
                location.href = `share/${token}`
                return
            }
            
            $submit.disabled = false
        })
    })
</script>