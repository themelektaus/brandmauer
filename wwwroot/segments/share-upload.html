<h2><i class="fas fa-paperclip"></i>Share</h2>
<div id="form">
    <textarea id="text" type="text" placeholder="Title / Description / Notes"></textarea>
    <input id="file" type="file" multiple>
    <label for="file">Drop file here or click to open dialog</label>
</div>
<button id="submit"><i class="fas fa-paper-plane"></i>Submit</button>
<style>
    h2 {
        font-size: 2em;
    }
    h2 > i {
        color: #f90;
        margin-right: .375em;
    }
    #form {
        width: 25em;
        display: flex;
        flex-direction: column;
        flex: 0;
        gap: 1rem;
        margin: 1rem 0;
    }
    #form > #text {
        height: 7.75em;
    }
    #form > #file {
        display: none;
    }
    #form > #file + label {
        background: #0006;
        border: 2px dashed #fff5;
        padding: 1rem 1rem;
        cursor: pointer;
        box-sizing: border-box;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: .75rem;
        text-align: center;
    }
    #form > #file + label:hover {
        filter: brightness(1.4);
    }
    #form > #file + label,
    #form > #file + label > div {
        width: 21em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    #form > #submit {
        align-self: center;
    }
</style>
<script>
    addEventListener(`load`, () =>
    {
        const $label = q(`label[for="file"]`)
        
        const updateLabel = () =>
        {
            let html = ``
            for (const file of $file.files)
                html += `<div>${file.name}</div>`
            $label.innerHTML = html
        }
        
        const $text = q(`#text`)
        const $file = q(`#file`)
        
        $file.addEventListener('change', () => updateLabel())
        
        const register = (a, b) =>
        {
            for (const _a of a)
                document.body.addEventListener(_a, b)
        }
        
        register(['dragover', 'dragenter'], e =>
        {
            e.preventDefault()
        })
        
        register(['drop'], e =>
        {
            e.preventDefault()
            $file.files = e.dataTransfer.files
            updateLabel()
        })
        
        const $submit = q(`#submit`)
        
        $submit.addEventListener(`click`, async () =>
        {
            $submit.disabled = true
            
            const formData = new FormData()
            formData.append('text', $text.value)
            for (const file of $file.files)
                formData.append('files[]', file)
            
            const response = await fetch(`share`,
            {
                method: "POST",
                body: formData
            })
            
            if (response.ok)
            {
                const token = await response.text()
                location.href = `share/${token}`
                return
            }
            
            $submit.disabled = false
        })
    })
</script>